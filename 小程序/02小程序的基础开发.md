## 语法

### 列表循环

```html
<!--
	wx:for等同于 v-for
	省略item，index；可以直接使用
	*this 表示item
	wx:key="name" 表示item.name
	wx:for-item="movie" movie 等同于item
--> 
<view class="movie" wx:for="{{movies}}" wx:key="*this">
  {{item}}-{{index}}
</view>

<view class="movie" wx:for="{{movies}}" wx:key="name">
  {{item}}-{{index}}
</view>

<view class="movie" wx:for="{{movies}}" wx:for-item="movie" wx:key="name">
  {{movie}}
</view>
```



### 事件监听

```html
<!--
	bindtap等同于 @click
	省略item，index；可以直接使用
	*this 表示item
--> 

<view>
  <view>当前计数：{{count}}</view>
  <button type="primary" bindtap="increment">+1</button>
  <button type="default" bindtap="decrement">-1</button>
</view>
```

```js
// favor.js
// 没有数据劫持，需要 setData 修改数据状态
Page({
  increment() {
    this.setData({
      count: this.data.count + 1
    })
  },
  decrement() {
    this.setData({
      count: this.data.count - 1
    })
  },
})

// 下拉和到达底部 需开启
  onPullDownRefresh() {
    console.log(1);

    setTimeout(() => {
      wx.stopPullDownRefresh({
        success:()=>{
          this.setData({
            listCount:40
          })
        },
        fail:()=>{
          console.log(3);
        }
      })
    }, 1000);
  },

  onReachBottom() {
    console.log(this.data.listCount);
    this.setData({
      listCount:this.data.listCount+ 30
    })
  }
```



### app函数

globalData 共享数据，不具有响应式

```
onLaunch // 登陆逻辑
onShow // 判断小程序进入的场景
```



### page函数

```html
<!--
	data-item 可以在target中获取，但是更建议在currentTarget中去拿
--> 

<view>
  <button 
  	wx:for="{{pages}}" 
    data-item="{{item}}"
    bindtap="onBtnClick"
    wx:key="item.path"
    type="primary">
 	{{item.name}}
  </button>
</view>

<!--
	style="background: {{item}};  都是{{}}双大括号
--> 
<button wx:for="{{btn}}" wx:key="*this" style="background: {{item}};">{{item}}</button>

<!--
	hover-class="active" 点击增加active类名
--> 
<button hover-class="active">hover</button>

<!--
	open-type="contact" 打开客服会话
-->
<button open-type="contact">打开会话</button>

<!--
	bindgetuserinfo 不再受用，getUserProfile获取信息
-->
<button bindtap="getUserInfo">获取用户信息</button>
<button bindgetuserinfo="getUserInfo"></button>

<!--
	chooseMedia 选择媒体元素
-->
<button bindtap="chooseImage">选择图片</button>


<!-- 
	image 默认320*240 
	mode 设置显示模式
	widthFix 宽度不变即320，高度自适应
-->
<image src="/assets/nhlt.jpg" mode="widthFix"/>


<!-- 
	scroll-view 固定高度上下左右滚动
	class="" 不能设置container！！！
	scroll-y 上下滚动
	scroll-x 左右滚动
	bindscrolltolower 滚动到底部或者右边
	bindscrolltoupper 滚动到顶部或者左边
-->
<scroll-view class="cont" enable-flex scroll-y bindscrolltoupper="onScrollUpper" bindscrolltolower="onScrollLower">
  <block wx:for="{{viewColor}}" wx:key="*this">
    <view class="item" style="background: {{item}};">{{item}}</view>
  </block>
</scroll-view>

```

```js
 // 加载网络请求
  onLoad() {
    wx.request({
      url: '',
      success: (res) => {
        const rData = res.data.data
        const {
          banner,
          recommend,
          keywords
        } = rData
        this.setData({
          banner: banner.list,
          recommend
        })
        console.log(res);
      }
    })
  },
 
// 获取用户信息---不包括手机号
  getUserInfo(evt) {
    wx.getUserProfile({
      desc: 'desc',
      success: (res) => {
        console.log(res);
      }
    })
  },

// 选择图片
  chooseImage(){
    wx.chooseMedia({
      mediaType:'image'
    }).then(res => {
      console.log(res);
    })
  },

// 事件绑定
onBtnClick(evt) {
    const item = evt.target.dataset.item 
    console.log(item);
    wx.navigateTo({
      url: item.path, // 不允许跳转tabbar中的页面
    })
  }

// 滚动距离
  onPageScroll(evt) {
    console.log(evt); // scrollop: 距离顶部的距离
  },
    
// 生命周期 执行顺序
onLoad onShow onReady onUnload
```







### wxs

> wxs是和javascript不同的语言，有自己的语法，只能写es5代码

wxs的作用是用来处理wxml中的数据，因为wxml不支持vue中的计算属性写法

特点和限制：

1. 所有版本的小程序都可使用
2. wxs的运行环境和javascript代码是隔离的，不能调用javascript文件中的函数，也不能调用小程序的api

- 使用commonjs方式导出

```js
// 两种使用方式
<!--pages/wxs/index.wxml-->
<text>pages/wxs/index.wxml</text>

<wxs module="format">
  function calcToal(nums) {
   return nums.reduce(function (pre, next) {
      return pre + next
    }, 0)
  }
  module.exports = {
    calcToal: calcToal
  }
</wxs>

// 推荐使用这种；文件后缀为 .wxs
<wxs src="/utils/calc.wxs" module="format"/>


<view>当前技术：{{format.calcToal(num)}}</view>
```

```js

function calcToal(nums) {
  return nums.reduce(function (pre, next) {
     return pre + next
   }, 0)
 }
 module.exports = {
   calcToal: calcToal
 }
```



## 样式

### 尺寸单位

rpx：根据屏幕宽度进行自适应，规定屏幕宽度为750px

Iphone6的宽度为375px，也就是1px = 750/375 = 2rpx









## 自定义组件

```json
{
  "component": true, // 表示该文件为组件
  "usingComponents": {}
}
```

### 样式

1. 默认会与page中的样式分离，但可以在page的Component对象中传递相应值改变隔离类型
2. 自定义组件样式需使用类选择器，不能使用id，标签等

```js
Component({
  options:{
    styleIsolation:'apply-shared'
  },
})
```



### 使用

1. 页面使用需要注册

```json
{
  "usingComponents": {
    "cpn1":"/components/my-cpn"
  }
}
```





### 通信

#### 父传子

```
<cpn1 name="万"></cpn1>
```

```js
// pages/my-cpn/index.js
Component({
  properties: {
    name: {
      type: String,
      value: 'one'
    }
  },
  options: {
    styleIsolation: 'apply-shared'
  },

  data: {

  },

  /**
   * 组件的方法列表
   */
  methods: {

  }
})
```

#### 子传父

```html
<!-- 子组件 步骤1-->
<button bindtap="onBtnClick">组件内部事件</button> 
```

```js
// pages/my-cpn/index.js
Component({
  methods: {
    // 子组件 步骤2。方法写在methods中
    onBtnClick(){
      this.triggerEvent('cpnClick','event-cpn-btn')
    }
  }
})
```

```html
<!-- 父组件 步骤3 bind加上子组件发过来的shi jian ming-->
<cpn1 name="万" bindcpnClick="onCpnClick"></cpn1>
```

```js
// pages/cpn1/index.js
Page({
  onCpnClick(e){
    console.log(e);// 父组件 在 e.detail 中可以获取到传过来的数据
  },
})
```

### 插槽

小程序中插槽不支持默认值，可以通过技术实现

```
.container:empty + .default //判断container中是否有元素
```

